# Starter pipeline

# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- bash: echo "Hello world!" > test.txt
- task: AzureCLI@2
  inputs:
    azureSubscription: 'Free Trial(9c59814a-0836-4ff3-8de7-5f7a3b31959e)'
    scriptType: 'batch'
    scriptLocation: 'inlineScript'
    inlineScript: 'az storage blob upload --container-name builds --file test.txt --name test.txt'
    
# - script: |
#     #!/bin/bash

#     # Download xoreos-tools
#     git clone git://github.com/xoreos/xoreos-tools

#     # Download and unzip latest version of azcopy
#     # wget https://azcopyvnext.azureedge.net/release20200501/azcopy_linux_amd64_10.4.3.tar.gz
#     # tar -xvf azcopy_linux_amd64_10.4.3.tar.gz
#     # mv azcopy_linux_amd64_10.4.3 az
    
#     # Update apt-get
#     sudo apt-get update
    
#     # Download files from Google Drive
#     sudo apt-get install unzip
    
#     wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=18CUUm7kTGmEsapCVxAdSvHL3yM0KU5yb' -O scripts.zip
#     unzip scripts.zip

#     azcopy --source scripts.zip --destination 'https://xoreosbuilds.blob.core.windows.net/builds/scripts.zip'

#     # Set permissions on scripts to make them runnable
#     chmod 777 setup.sh mingw32-8.3 mingw_inst.sh crosscompilexoreos.sh

#     # Convert the line endings
#     sudo apt-get install dos2unix
#     dos2unix setup.sh mingw32-8.3 mingw_inst.sh crosscompilexoreos.sh
#     # Run the setup script
#     ./setup.sh

#     # Cross compile
#     ./crosscompilexoreos.sh xoreos-tools

#     # Zip up the files
#     zip -o release.zip /home/$USER/RELEASEBIN
    
#     # Upload the files to Azure storage
#     azcopy --source release.zip --destination 'https://xoreosbuilds.blob.core.windows.net/builds/release.zip'

#   displayName: 'Build xoreos-tools for Ubuntu'
